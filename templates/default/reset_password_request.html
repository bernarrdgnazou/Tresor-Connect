{% extends "base.html" %}
{% block title %}Mot de passe oublié - TRÉSOR CONNECT{% endblock %}

{% block style %}
<link href="{{ url_for('static', filename='css/forms.css') }}" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="login-container">
  <div class="login-card">
    <h2 class="login-title"><i class="fas fa-key"></i> Réinitialiser le mot de passe</h2>
    
    <!-- Affichage des messages flash -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
            <i class="fas fa-{% if category == 'success' %}check-circle{% elif category == 'danger' %}exclamation-circle{% elif category == 'warning' %}exclamation-triangle{% else %}info-circle{% endif %} me-2"></i>
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <p class="text-muted text-center">
      Entrez votre adresse email, nous vous enverrons un lien pour réinitialiser votre mot de passe.
    </p>

    <form action="{{ url_for('reset_password_request') }}" method="post" autocomplete="off">
      {{ form.hidden_tag() }}
      
      <!-- Email -->
      <div class="form-group">
        <label for="email"><i class="fas fa-envelope"></i> Email</label>
        {{ form.email(class="form-control", id="email", placeholder="Votre email") }}
        {% if form.email.errors %}
          <div class="text-danger">
            {% for error in form.email.errors %}
              <small>{{ error }}</small>
            {% endfor %}
          </div>
        {% endif %}
      </div>

      <!-- Bouton -->
      <button type="submit" class="btn-login">
        <i class="fas fa-paper-plane me-2"></i>Envoyer le lien de réinitialisation
      </button>

      <!-- Lien retour -->
      <p class="signup-link mt-3 text-center">
        <a href="{{ url_for('connexion') }}">
          <i class="fas fa-arrow-left me-1"></i>Retour à la connexion
        </a>
      </p>
    </form>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Validation en temps réel de l'email
  const emailField = document.getElementById('email');
  const submitButton = document.querySelector('.btn-login');
  
  function validateEmail() {
    const emailValid = emailField.value.includes('@') && emailField.value.includes('.');
    
    submitButton.disabled = !emailValid;
    submitButton.style.opacity = emailValid ? '1' : '0.6';
    
    // Feedback visuel
    if (emailField.value === '') {
      emailField.style.borderColor = '#e1e5e9';
    } else {
      emailField.style.borderColor = emailValid ? '#28a745' : '#dc3545';
    }
  }
  
  emailField.addEventListener('input', validateEmail);
  validateEmail(); // Validation initiale
  
  // Animation de soumission
  const form = document.querySelector('form');
  form.addEventListener('submit', function(e) {
    const emailValid = emailField.value.includes('@') && emailField.value.includes('.');
    
    if (emailValid) {
      submitButton.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Envoi en cours...';
      submitButton.disabled = true;
    }
  });
});
</script>
{% endblock %}